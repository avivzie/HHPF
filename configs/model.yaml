# Model configuration for HHPF

# Llama-3 Inference Settings
llama:
  # Model selection (Together AI serverless models)
  model_8b: "meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo"
  model_70b: "meta-llama/Llama-3.3-70B-Instruct-Turbo"
  default_model: "meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo"
  
  # Generation parameters
  max_tokens: 1024
  temperature: 0.8  # For stochastic sampling
  top_p: 0.95
  top_k: 50
  
  # Stochastic sampling for semantic entropy
  num_samples: 5  # Reduced from 10 to 5 (2026-02-04) to speed up generation and reduce API timeouts
  sample_temperature_range: [0.7, 1.0]  # Vary temperature for diversity
  
  # API settings
  api_timeout: 90  # Increased from 60 to 90 seconds for longer generations
  max_retries: 3
  retry_delay: 2  # Base delay for exponential backoff (2s, 4s, 8s)
  rate_limit_delay: 0.5  # seconds between requests
  
  # Logits extraction
  logprobs: 5  # Number of top logits to extract (Together AI max: 5)
  echo: false

# XGBoost Classifier Settings
xgboost:
  # Initial hyperparameters (conservative defaults to prevent overfitting)
  max_depth: 3
  learning_rate: 0.05
  n_estimators: 100
  min_child_weight: 3
  subsample: 0.8
  colsample_bytree: 0.8
  gamma: 0.5
  reg_alpha: 0.5
  reg_lambda: 3
  
  # Training settings
  objective: "binary:logistic"
  eval_metric: ["auc", "logloss"]
  early_stopping_rounds: 20
  
  # Hyperparameter tuning
  hyperparameter_tuning:
    enabled: true
    method: "optuna"  # or "grid_search"
    n_trials: 20  # Use 20 for pipeline runs; increase to 100 for full tuning
    cv_folds: 5
    search_space:
      max_depth: [4, 6, 8, 10]
      learning_rate: [0.01, 0.05, 0.1]
      n_estimators: [100, 200, 300]
      min_child_weight: [1, 3, 5]
      subsample: [0.7, 0.8, 0.9]
      colsample_bytree: [0.7, 0.8, 0.9]
      gamma: [0, 5]
      reg_alpha: [0, 5]
      reg_lambda: [1, 10]
  
  # Class imbalance handling
  scale_pos_weight: "auto"  # Automatically calculate based on class distribution
  scale_pos_weight_multiplier: 1.0  # Multiplier for scale_pos_weight (>1.0 increases sensitivity to positive class)
                                     # Note: Set to 2.0 for psychology domain to fix low recall (0.16 -> 0.84)

# Cache Settings
cache:
  enabled: true
  cache_dir: "./cache"
  cache_responses: true
  cache_features: true
  cache_models: true
